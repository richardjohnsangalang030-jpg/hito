<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Hito Farm Realtime Dashboard</title>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <style>
    body { background-color: #0f172a; font-family: Arial, sans-serif; color: white; padding: 20px; }
    h1 { margin-bottom: 20px; }
    .container { display: flex; flex-wrap: wrap; gap: 15px; }
    .card { background: #020617; border-radius: 12px; padding: 20px; width: 240px; box-shadow: 0 0 10px rgba(0,0,0,0.4); }
    .card h2 { font-size: 18px; margin: 0; color: #94a3b8; }
    .value { font-size: 32px; font-weight: bold; margin-top: 10px; }
    .status { color: #22c55e; }
    .valve-status { color: #facc15; }
    button { margin-top: 10px; padding: 10px; width: 100%; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; background-color: #3b82f6; color: white; }
    button:hover { background-color: #2563eb; }
    select { margin-top: 10px; padding: 8px; border-radius: 8px; font-size: 16px; width: 100%; background-color: #1e293b; color: white; border: none; }
    .manual-controls { display: none; margin-top: 10px; }
    .valve-card { display: none; }
  </style>
</head>

<body>

<h1>ðŸŒŠ Hito Farm Realtime Dashboard</h1>

<!-- Sensor Data Cards -->
<div class="container">
  <div class="card">
    <h2>pH Level</h2>
    <div class="value" id="ph">--</div>
  </div>

  <div class="card">
    <h2>Turbidity (NTU)</h2>
    <div class="value" id="ntu">--</div>
  </div>

  <div class="card">
    <h2>Water Temperature</h2>
    <div class="value" id="waterTemp">--</div>
  </div>

  <div class="card">
    <h2>Air Temperature</h2>
    <div class="value" id="airTemp">--</div>
  </div>

  <div class="card">
    <h2>Humidity</h2>
    <div class="value" id="humidity">--</div>
  </div>

  <div class="card">
    <h2>Mode</h2>
    <div class="value status" id="status">--</div>
  </div>

  <!-- Manual Mode Cards -->
  <div class="card valve-card" id="valveCard">
    <h2>Valve Status</h2>
    <div class="value valve-status" id="valveStatus">--</div>
  </div>

  <div class="card valve-card" id="feedStatusCard">
    <h2>Manual Feed Status</h2>
    <div class="value valve-status" id="feedStatus">--</div>
  </div>
</div>

<!-- Control Mode Selection -->
<h2>Mode Selection</h2>
<div class="container">
  <div class="card">
    <h2>Control Mode</h2>
    <select id="modeSelect">
      <option value="automatic">Automatic</option>
      <option value="manual">Manual</option>
    </select>

    <div class="manual-controls" id="manualControls">
      <button id="feedButton">Feed Fish</button>
      <button id="valveButton">Toggle Valve</button>
    </div>
  </div>
</div>

<script>
  // ===== Firebase Configuration =====
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "hito-monitoring-default-rtdb.firebaseapp.com",
    databaseURL: "https://hito-monitoring-default-rtdb.firebaseio.com",
    projectId: "hito-monitoring",
    storageBucket: "hito-monitoring.appspot.com",
    messagingSenderId: "XXXXXX",
    appId: "XXXXXX"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const database = firebase.database();

  // ===== Sensor Data Binding =====
  database.ref("HitoFarm/WaterQuality/pH").on("value", snap => {
    if(snap.exists()) document.getElementById("ph").innerText = snap.val().toFixed(2);
  });

  database.ref("HitoFarm/WaterQuality/TurbidityNTU").on("value", snap => {
    if(snap.exists()) document.getElementById("ntu").innerText = snap.val() + " NTU";
  });

  database.ref("HitoFarm/WaterQuality/WaterTemperature").on("value", snap => {
    if(snap.exists()) document.getElementById("waterTemp").innerText = snap.val() + " Â°C";
  });

  database.ref("HitoFarm/WaterQuality/AirTemperature").on("value", snap => {
    if(snap.exists()) document.getElementById("airTemp").innerText = snap.val() + " Â°C";
  });

  database.ref("HitoFarm/WaterQuality/Humidity").on("value", snap => {
    if(snap.exists()) document.getElementById("humidity").innerText = snap.val() + " %";
  });

  // ===== Control Mode Binding =====
  const statusEl = document.getElementById("status");
  const valveCard = document.getElementById("valveCard");
  const valveStatusEl = document.getElementById("valveStatus");
  const feedStatusCard = document.getElementById("feedStatusCard");
  const feedStatusEl = document.getElementById("feedStatus");

  database.ref("HitoFarm/ControlMode").on("value", snap => {
    if(snap.exists()) {
      const mode = snap.val().toUpperCase();
      statusEl.innerText = mode;
      document.getElementById("modeSelect").value = snap.val();

      const isManual = (snap.val() === "manual");
      document.getElementById("manualControls").style.display = isManual ? "block" : "none";
      valveCard.style.display = isManual ? "block" : "none";
      feedStatusCard.style.display = isManual ? "block" : "none";
    }
  });

  // ===== Valve Status Binding (Manual Relay1Toggle) =====
  database.ref("HitoFarm/Manual/Relay1Toggle").on("value", snap => {
    if(snap.exists()) {
      const isOn = snap.val(); // true or false
      valveStatusEl.innerText = isOn ? "OPEN" : "OFF";
    }
  });

  // ===== Manual Feed Status Binding =====
  database.ref("HitoFarm/Manual/Feed").on("value", snap => {
    if(snap.exists()) {
      const isFeeding = snap.val();
      feedStatusEl.innerText = isFeeding ? "ON" : "OFF";
    }
  });

  // ===== Mode Selection Dropdown =====
  const modeSelect = document.getElementById("modeSelect");
  const manualControls = document.getElementById("manualControls");

  modeSelect.addEventListener("change", () => {
    const mode = modeSelect.value;
    database.ref("HitoFarm/ControlMode").set(mode);
    manualControls.style.display = (mode === "manual") ? "block" : "none";
    valveCard.style.display = (mode === "manual") ? "block" : "none";
    feedStatusCard.style.display = (mode === "manual") ? "block" : "none";
  });

  // ===== Manual Buttons =====
  document.getElementById("feedButton").addEventListener("click", () => {
    database.ref("HitoFarm/Manual/Feed").set(true);
    alert("Manual Feed Triggered!");
  });

  document.getElementById("valveButton").addEventListener("click", () => {
    // toggle the valve
    database.ref("HitoFarm/Manual/Relay1Toggle").get().then(snap => {
      const current = snap.exists() ? snap.val() : false;
      database.ref("HitoFarm/Manual/Relay1Toggle").set(!current);
    });
  });
</script>

</body>
</html>
